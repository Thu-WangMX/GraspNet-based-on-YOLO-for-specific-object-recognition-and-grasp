import rtde_receive
import rtde_control
import math
rtde_r = rtde_receive.RTDEReceiveInterface("192.168.101.101")
rtde_c = rtde_control.RTDEControlInterface("192.168.101.101")
# rtde_c.moveL([-0.21389424801091184, 0.3829769192409688, 0.22378373210100433, -3.1411130347220086, -0.015957557239074063, -0.0021867752378030296])
# rtde_c.moveL([-0.2150404142167849, 0.49622109628911454, 0.22385358573072128, -3.1410874055916764, -0.015921852523727822, -0.00211544598275732])
# rtde_c.moveL([-0.21503969554128768, 0.49623009930274453, 0.22386773179383423, 2.2119497307832288, 2.230055680924822, 0.0020155685772029874])


# rtde_c.moveL([-0.2345692533523287, 0.4704995114135435, 0.22379499654873874, 2.2119208233349026, 2.23002225513787, 0.0020286229496924955])
# rtde_c.moveL([-0.23463808482721377, 0.3033986838999124, 0.22373214463043542, 2.211896590870122, 2.230065719475213, 0.0019722414396983437])
# rtde_c.moveL([-0.23462599204140824, 0.30340588524347945, 0.22371759513421197, -0.039377111922462946, 3.1399884391893447, 0.0006790831879181724])



# rtde_c.moveL([-0.21149608389898944, 0.33909805451930386, 0.22376855793231903, -0.039383496988530664, 3.1400063635593356, 0.0006570247674123111])
# rtde_c.moveL([-0.2154604200006236, 0.496793022849148, 0.22383230362818574, -0.03941799297738682, 3.1400110208811194, 0.0006765368415716411])

PRESET_POSE = [0.027117064539698317, -0.540667859882648, 0.3334746173887342, 0.02902402476628025, -3.085745258188834, 0.26548247436846184]
# # mid_pose = PRESET_POSE[0:3]+rtde_r.getActualTCPPose()[3:6]
# current_q = rtde_r.getActualQ()
# current_joint_6_rad = current_q[-1]
# target_q = rtde_c.getInverseKinematics(PRESET_POSE, current_q)

# # 检查计算出的解是否有效
# if not target_q or len(target_q) != 6:
#     print("无法找到逆运动学解。")
#     # 在此处添加错误处理逻辑
# else:
#     # 3. 检查第6关节的角度差
#     # 这里是关键：我们不希望它走远路
#     # 将角度差规范化到 -pi 到 pi 之间
#     diff_joint_6 = target_q[-1] - current_joint_6_rad
#     while diff_joint_6 > math.pi:
#         diff_joint_6 -= 2 * math.pi
#     while diff_joint_6 < -math.pi:
#         diff_joint_6 += 2 * math.pi

#     # 如果角度差的绝对值大于某个阈值 (例如180度，即pi弧度)，说明可能会翻转
#     if abs(diff_joint_6) > math.pi:
#         print(f"检测到第6关节可能发生翻转。当前角度: {math.degrees(current_joint_6_rad):.2f}度, 目标角度: {math.degrees(target_q[-1]):.2f}度")
#         # 调整目标关节角，让它走更近的路
#         # 如果目标是负的，就加360度；如果是正的，就减360度
#         if target_q[-1] < current_joint_6_rad:
#                 target_q[-1] += 2 * math.pi
#         else:
#                 target_q[-1] -= 2 * math.pi
#         print(f"调整后的目标角度: {math.degrees(target_q[-1]):.2f}度")


#     # 4. 使用 moveJ 移动到计算出的最优关节角度
#     # 因为我们已经找到了一个不会翻转的关节目标，所以可以直接用 moveJ
#     print("使用 moveJ 移动到目标关节角度...")
#     rtde_c.moveJ(target_q, 1.5, 1.5) # 使用适当的速度和加速度

# rtde_c.moveL(PRESET_POSE, 0.4, 0.4)

#actual_angle = rtde_r.getActualQ()

actual_q =rtde_r.getActualTCPPose()
print(actual_q)
# #第一个面
# rtde_c.moveL([-0.2084593168889884, 0.3631707277560207, 0.2154811073799703, -3.1411506062586976, -0.015990595314362185, -0.0021950167510790264])
# rtde_c.moveL([-0.20846151562277754, 0.4501301360728408, 0.21552524680716242, -3.141084549301299, -0.015983921852158012, -0.0020936771529843352])
# rtde_c.moveL([-0.17478677978884666, 0.45013038245609727, 0.21550983641668833, -3.141102269493665, -0.01596840178978441, -0.0021585357499310106])
# #第二个面
# rtde_c.moveL([-0.19097865925703403, 0.4501306540528917, 0.21550727542276177, -2.1963239459749073, -2.244459094196472, -0.001036517918187775])
# rtde_c.moveL([-0.23060567131812226, 0.47650000477064997, 0.21476831759108084, -2.192694508468386, -2.240753143734028, 0.007395940841533544])
# rtde_c.moveL([-0.22745618688174124, 0.3253100899281812, 0.21457939201964826, -2.1926465392068466, -2.240781417042305, 0.007356542757640811])
# rtde_c.moveL([-0.1883025830894397, 0.3601140760545894, 0.21477788404648152, -2.1963667804244023, -2.244510969893468, -0.0010233160603499594])
# rtde_c.moveL([-0.18828037761664979, 0.36010563960402087, 0.21477409703564712, 0.04116497752360671, -3.1399825864467115, 0.0007281295937734772])   
# rtde_c.moveL([-0.20945844401079242, 0.38135238182135534, 0.21478471472025387, 0.041205515769631856, -3.1399616439768097, 0.0006841834450496923])
# rtde_c.moveL([-0.20920584356496044, 0.44948579095209445, 0.21478967369870194, 0.041180647053449676, -3.139977919500335, 0.0006755085605454072])
# rtde_c.moveL([-0.1307486487085701, 0.44949773651508634, 0.2147892759260576, 0.041194567891180395, -3.139979775863273, 0.0006444077961895975])

rtde_c.moveL(PRESET_POSE,0.1,0.1)
